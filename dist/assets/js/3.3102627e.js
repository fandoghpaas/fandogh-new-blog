(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{159:function(e,t,n){"use strict";n.r(t);var s=n(0),a=Object(s.a)({},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content"},[n("p",[e._v("برای دیپلوی کردن پروژه جنگو یا هر پروژه دیگه‌ای روی فندق لازمه که پروژه داکرایز بشه، یعنی این قابلیت رو داشته باشه که روی یک Docker container به درستی اجرا بشه.\nشاید یکم پیچیده به نظر برسه اما اگر این آموزش رو قدم به قدم پیش برید به سادگی می‌تونید اینکار رو انجام بدید.\nوقتی پروژه جنگو رو میخواید در قالب یک Container اجرا کنید باید اولا چند تا تغییر کوچک روی پروژه بدید و دوما یک Dockerfile برای پروژه بنویسید،‌ که هر کدوم رو توضیح میدم:")]),e._v(" "),e._m(0),e._v(" "),n("p",[e._v("چند تا تغییر توی کد پروژه باید مد نظر قرار بدید که با هم بررسی می‌کنیم:")]),e._v(" "),e._m(1),e._v(" "),n("p",[e._v("پروژه‌های جنگو تقریبا همیشه یک دیتابیسی دارند، مهم نیست دیتابیس شما Sqlite باشه یا MySQL یا Postgresql یا هر چیز دیگه‌ای می‌تونید از فندق استفاده کنید اما در مورد هر دیتابیسی یه سری نکات هست باید حواستون باشه:")]),e._v(" "),e._m(2),e._v(" "),e._m(3),e._v(" "),e._m(4),e._m(5),e._v(" "),e._m(6),e._v(" "),n("p",[e._v("برای دیتابیس MySQL به طور خاص می‌تونید از قابلیت managed-service استفاده کنید، این قابلیت یک دیتابیس MySQL برای شما ایجاد می‌کنه و با نام‌کاربری و رمزعبوری که انتخاب می‌کنید روی آدرس دلخواه شما در اختیار شما قرار میده.\nبرای ساخت یک دیتابیس MySQL باید از fandogh_cli استفاده کنید و می‌تونید روش انجام اینکار رو "),n("strong",[n("a",{attrs:{href:"https://github.com/fandoghpaas/fandogh-cli#managed-services",target:"_blank",rel:"noopener noreferrer"}},[e._v("اینجا"),n("OutboundLink")],1)]),e._v(" مطالعه کنید.\nمثلا با چنین دستوری یک سرویس MySQL برای شما ساخته میشه:")]),e._v(" "),e._m(7),n("p",[e._v("توجه داشته باشید که اسم سرویسی که انتخاب کردید مهم هستش، اگر اسمی انتخاب نکنید به صورت پیشفرض نام سرویس mysql خواهد بود، مثلا من اینجا my-database رو به عنوان اسم سرویس انتخاب کردم اگر انتخاب نمی‌کردم همون mysql اسم سرویسم میشد.\nدقت کنید که باید اول از طریق PHPMyAdminای که برای شما ساخته میشه یک دیتابیس بسازید، کافیه روی لینکی که که از fandogh_cli گرفتید کلیک کنید با یوزرنیم root و پسوردی که انتخاب کردید وارد PHPMyAdmin بشید.\nحالا داخل PHPMyAdmin می‌تونید به سادگی دیتابیس رو بسازید، اگر یک نگاهی به منو ها بندازید کار سختی نیست راحت می‌تونید بسازید ولی اگر مشکلی خوردید "),n("strong",[n("a",{attrs:{href:"http://webvaultwiki.com.au/Default.aspx?Page=Create-Mysql-Database-User-Phpmyadmin&NS=&AspxAutoDetectCookieSupport=1",target:"_blank",rel:"noopener noreferrer"}},[e._v("این آموزش"),n("OutboundLink")],1)]),e._v(" رو دنبال کنید.\nحالا با داشتن username و password و database name میتونید به سادگی تنظیمات جنگو رو مشخص کنید تا از MySQL استفاده کنه:")]),e._v(" "),e._m(8),n("p",[e._v("دقت کنید که به جای HOST باید مقداری که به عنوان service_name موقع ساخت سرویس استفاده کردید رو بنویسید.")]),e._v(" "),e._m(9),e._v(" "),n("p",[e._v("برای بقیه دیتابیس‌ها هم کار سختی نیست، کافیه که توی "),n("a",{attrs:{href:"https://hub.docker.com/explore/",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker hub "),n("OutboundLink")],1),e._v(" سرچ کنید داکرفایلشون رو پیدا کنید و "),n("a",{attrs:{href:"http://blog.fandogh.cloud/articles/fandogh-introduction.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("سرویستون رو از روی داکرفایل اون‌ها بسازید."),n("OutboundLink")],1),e._v(" البته اگر کمکی نیاز داشتید می‌دونید که ما همیشه آماده پاسخگویی به شما دوستان عزیز هستیم.")]),e._v(" "),e._m(10),e._v(" "),n("p",[e._v("نکاتی که تا الان گفتیم رو به همون شکلی که توضیح دادیم می‌تونید استفاده کنید، اما بهتر این هستش که یک سری مقادیر که تغییر می‌کنه اینطوری داخل کد نوشته نشه، مثلا HOSTای که برای MySQL استفاده می‌کنید یا USERNAME و PASSWORD بهتر هستش که از environment variables خونده بشه، ما هم توی این آموزش همین کار رو می‌کنیم، مثلا برای MySQL این تنظیمات رو استفاده می‌کنیم:")]),e._v(" "),e._m(11),e._m(12),e._v(" "),e._m(13),e._m(14),e._v(" "),n("p",[e._v("در درجه اول توصیه می‌کنم حتما مستندات خود داکر رو در این مورد بخونید:\nhttps://docs.docker.com/engine/reference/builder/#usage\nبرای توضیح داکر فایل اجازه بدید از یک مثال واقعی استفاده کنیم که می‌تونید کد مربوط بهش رو به طور کامل اینجا ملاحظه کنید:\nhttps://github.com/fandoghpaas/bestoon")]),e._v(" "),n("p",[e._v("داکر فایل این پروژه جنگو به این شکل نوشته شده:")]),e._v(" "),e._m(15),e._m(16),e._v(" "),e._m(17),n("p",[e._v("این اسکریپت اول migration ها رو اجرا می‌کنه و بعد هم پروژه جنگو رو روی پورت ۸۰۰۰ ران می‌کنه.\nاگر مثلا به collectstatic یا هر کامند دیگه‌ای هم نیاز باشه توی همین فایل اسکریپت می‌تونیم اضافه‌اش کنیم.")]),e._v(" "),e._m(18),e._v(" "),e._m(19),n("p",[e._v("اگر وضعیت ایمیج BUILT بود یعنی تا اینجا همه چیز اوکیه!\nتوی فایل settings.py این پروژه، دیتابیس به این شکل مشخص شده:")]),e._v(" "),e._m(20),n("p",[e._v("پس موقع دیپلوی سرویس این متغیر ها رو باید پاس بدیم:")]),e._v(" "),e._m(21),n("p",[e._v("توجه داشته باشید که شما بایدآدرس سرویس خود بر روی سرور فندق را در فایل settings.py پروژه خود به متغیر ALLOWED_HOSTS اضافه کنید.")]),e._v(" "),n("p",[e._v("فرمت این آدرس به صورت پیش فرض به شکل زیر است:")]),e._v(" "),e._m(22),n("p",[e._v("همچنین توجه کنید که:")]),e._v(" "),e._m(23),e._v(" "),e._m(24),e._m(25),e._v(" "),n("p",[e._v("کلیت داستان داکرایز کردن همین بود، هر گونه سوال یا کمک نیاز داشتید از طریق "),n("a",{attrs:{href:"https://github.com/fandoghpaas/fandogh-cli/issues",target:"_blank",rel:"noopener noreferrer"}},[e._v("ایشوهای گیتهاب"),n("OutboundLink")],1),e._v(" با ما تماس بگیرید.")])])},[function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"تغییرات-پروژه"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#تغییرات-پروژه","aria-hidden":"true"}},[this._v("#")]),this._v(" تغییرات پروژه")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"دیتابیس"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#دیتابیس","aria-hidden":"true"}},[this._v("#")]),this._v(" دیتابیس")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h4",{attrs:{id:"نکات-مربوط-به-دیتابیس-sqlite"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#نکات-مربوط-به-دیتابیس-sqlite","aria-hidden":"true"}},[this._v("#")]),this._v(" نکات مربوط به دیتابیس Sqlite")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",[e._v("دیتابیس Sqlite برای ذخیره سازی اطلاعات از یک فایل استفاده می‌کنه و اگر جنگو کار کرده باشید می‌دونید که به طور پیش‌فرض اون فایل رو همونجا کنار فایل "),n("code",[e._v("manage.py‍‍‍")]),e._v(" می‌سازه و این دقیقا یکی از مسائلی هستش که باید توی داکرایز کردن مورد توجه قرار بدید.\nفضایی که داخل container ها وجود داره مانا نیست، یعنی هر زمانی ممکنه container ریست بشه و اون فضا به طور کل خالی میشه و از نو ساخته میشه پس اگر دیتابیس یا فایل لاگ یا هر دیتای دیگه‌ای که زمان اجرا تولید میشه رو اونجا قرار بدید اطلاعاتتون رو ممکنه از دست بدید.\nیکی از امکاناتی که فندق در اختیار کاربرانش قرار میده یک فضای مانا هستش، فضایی که متعلق به کاربر هستش و می‌تونه با اطمینان داخلش بنویسه.\nاین فضا توی آدرس "),n("code",[e._v("/mnt/shared-volume")]),e._v(" قابل دسترس هستش، کافیه که به جنگو بگید فایل دیتابیس رو اونجا بسازه.\nبرای اینکار کافیه توی "),n("code",[e._v("settings.py")]),e._v(" به این شکل "),n("code",[e._v("DATABASE")]),e._v(" رو تنظیم کنید:")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("PERSISTENT_STORAGE = \"/mnt/shared-volume\"\nDATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.sqlite3',\n        'NAME': os.path.join(PERSISTENT_STORAGE, 'db.sqlite3'),\n    }\n}\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("اول یک متغیر تعریف کردیم که حاوی آدرس "),t("code",[this._v("/mnt/shared-volume")]),this._v(" هستش و بعد هم با به کمک "),t("code",[this._v("os.path.join‍‍")]),this._v(" مشخص کردیم که محلی که جنگو برای ذخیره دیتابیس باید استفاده کنه باید "),t("code",[this._v("/mnt/shared-volume/db.sqlite3")]),this._v(" باشه.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h4",{attrs:{id:"نکات-مربوط-به-دیتابیس-mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#نکات-مربوط-به-دیتابیس-mysql","aria-hidden":"true"}},[this._v("#")]),this._v(" نکات مربوط به دیتابیس MySQL")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v(" fandogh managed-service deploy mysql 9.4 \\\n -c service_name=my-database \\\n -c phpmyadmin_enabled=true \\\n -c mysql_root_password=test123\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("DATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.mysql',\n        'NAME': 'my-project',\n        'USER': 'root',\n        'PASSWORD': 'test123',\n        'HOST': 'my-database',\n        'PORT': '3306',\n    }\n}\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h4",{attrs:{id:"نکات-مربوط-به-دیتابیس‌های-دیگر"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#نکات-مربوط-به-دیتابیس‌های-دیگر","aria-hidden":"true"}},[this._v("#")]),this._v(" نکات مربوط به دیتابیس‌های دیگر")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"استفاده-از-environment-variables"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#استفاده-از-environment-variables","aria-hidden":"true"}},[this._v("#")]),this._v(" استفاده از Environment variables")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("DATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.mysql',\n        'NAME': os.environ.get(\"MYSQL_DB_NAME\"),\n        'USER': os.environ.get(\"MYSQL_USERNAME\"),\n        'PASSWORD': os.environ.get(\"MYSQL_PASSWORD\"),\n        'HOST': os.environ.get(\"MYSQL_HOST_NAME\"),\n        'PORT': '3306',\n    }\n}\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("به این ترتیب ما توی کد هیچ کدام از مقادیر متغیر رو قرار ندادیم و لازمه که موقع دیپلوی سرویس این مقادیر رو در اختیار app قرار بدیم، که جلوتر در موردش صحبت می‌کنیم.\nدر مورد مقدار متغیر ‍‍"),t("code",[this._v("PERSISTENT_STORAGE")]),this._v(" هم می‌تونیم همین کار رو بکنیم:")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('PERSISTENT_STORAGE = os.environ.get("PERSISTENT_STORAGE")\n\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"نوشتن-داکرفایل"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#نوشتن-داکرفایل","aria-hidden":"true"}},[this._v("#")]),this._v(" نوشتن داکرفایل")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('FROM python:2\nENV PYTHONUNBUFFERED 1\nRUN mkdir /code\nWORKDIR /code\nADD requirements.txt /code/\nRUN pip install -r requirements.txt\nADD . /code/\nENTRYPOINT ["sh","/code/run_bestoon.sh"]\n')])])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",[e._v("خط به خط با هم داکرفایل رو بررسی کنیم:\nخط "),n("strong",[e._v("FROM")]),e._v(" به معنی این هستش که این ایمیج باید بر اساس ایمیج پایتون ساخته شود، یعنی اگر فقط همین یک خط داخل داکر فایل باشد، یک کانتینر ساخته میشه که روش پایتون نصب هستش، اون عدد ۲ جلوی پایتون به معنی ورژن پایتون هستش، می‌تونید عدد ۳ بذارید برای پایتون ۳\nخط "),n("strong",[e._v("ENV")]),e._v(" برای ست کردن یک Environment variable استفاده میشه، توی این خط داریم مقدار PYTHONUNBUFFERED=1 رو داخل environment variableهای کانتینر ست می‌کنیم.\nخط "),n("strong",[e._v("RUN")]),e._v(" به معنی اجرا یک کامند لینوکسی هستش، که داخل کامند داریم با mkdir یک دایرکتوری داخل کانتینر درست می‌کنیم به نام code\nخط "),n("strong",[e._v("WORKDIR")]),e._v(" مثل cd در لینوکس عمل می‌کنه، و باعث میشه بقیه دستورات داخل دایرکتوری code اجرا بشند.\nخط "),n("strong",[e._v("ADD")]),e._v(" فایل requirements.txt رو از کنار داکرفایل برمیداره و داخل کانتینر کپی می‌کنه(داخل دایرکتوری /code)\nخط بعدی باز "),n("strong",[e._v("RUN")]),e._v(" هستش، و داریم با "),n("code",[e._v("pip install -r requirements.txt‍")]),e._v(" نیازمندی‌های پروژه رو نصب می‌کنیم.\nخط بعدی کل دایرکتوری رو کپی می‌کنه داخل دایرکتوری /code توی کانتینر\nو خط آخر، خط آخر "),n("strong",[e._v("ENTRYPOINT")]),e._v(" داره میگه که موقعی که کانتینر ایجاد شد اولین کامندی که داخل اجرا میشه چه کامندی هستش، که همون طور که میبینید اجرای یک اسکریپت هستش.\nبذارید داخل اون اسکریپت رو هم ببینیم:")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("#!/bin/bash\npython manage.py migrate\npython manage.py runserver 0.0.0.0:8000\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("حالا در نهایت برای اجرای این پروژه روی فندق اول باید لاگین کنیم "),t("code",[this._v("fandogh login")]),this._v(" و بعد ایمیج بسازیم "),t("code",[this._v("fandogh image init")]),this._v(" و در نهایت می‌تونیم این فایل‌ها رو به عنوان اولین ورژن از پروژه روی فندق منتشر کنیم "),t("code",[this._v("fandogh image publish")]),this._v(" اگر همه چیز خوب پیش رفته باشه، باید ایمیج به درستی روی سرور فندق بیلد شده باشه:")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("fandogh image versions\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("DATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.mysql',\n        'NAME': os.environ.get('DB_NAME', 'bestoon'),\n        'USER': os.environ.get('DB_USERNAME', 'root'),\n        'PASSWORD': os.environ.get('DB_PASSWORD', 'root'),\n        'HOST': os.environ.get('DB_HOST', 'mysql'),\n    }\n}\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("fandogh service deploy\\\n-e DB_NAME=mydatabase \\\n-e DB_USERNAME=root \\\n-e DB_PASSWORD=somepassword \\\n-e DB_HOST=my-database\\\n-p 8000\n\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("{YOUR_SERVICE_NAME}-{YOUR_NAMESPACE}.fandogh.cloud\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("باید قبلا mysql server شما به این شکل دیپلوی شده باشه")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("fandogh managed-service deploy mysql 9.1 \\\n-c service_name=my-database \\\n-c mysql_root_password=somepassword \\\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("از طریق PHPMyAdmin دیتابیس رو ساخته باشید!")])])}],!1,null,null,null);a.options.__file="django-projects.md";t.default=a.exports}}]);